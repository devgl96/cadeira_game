<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Avoid Objects Game</title>
    <style>
      body {
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        height: 100vh;
        margin: 0;
        background-color: #f0f0f0;
        font-family: Arial, sans-serif;
      }
      h1 {
        text-align: center;
        margin-bottom: 20px;
        font-size: 2rem;
      }
      #gameWrapper {
        display: flex;
        flex-direction: column;
        align-items: center;
      }
      #gameArea {
        width: 400px;
        height: 400px;
        border: 1px solid black;
        position: relative;
        overflow: hidden;
        background-color: #fff;
      }
      #character {
        width: 20px;
        height: 20px;
        background-image: url("assets/cap.png");
        background-size: cover;
        position: absolute;
        border-radius: 50%;
        left: 190px;
        top: 190px;
      }
      .object {
        width: 20px;
        height: 20px;
        background-image: url("assets/chair.png");
        background-size: cover;
        position: absolute;
      }
      #score,
      #instructions,
      #startButton {
        margin-top: 10px;
      }
      #modal {
        display: none;
        position: fixed;
        z-index: 1;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.4);
      }
      .modal-content {
        background-color: #fefefe;
        margin: 15% auto;
        padding: 20px;
        border: 1px solid #888;
        width: 300px;
        text-align: center;
      }
      #closeModal {
        color: #aaa;
        float: right;
        font-size: 28px;
        font-weight: bold;
        cursor: pointer;
      }
    </style>
  </head>
  <body>
    <div id="gameWrapper">
      <h1>Avoid Objects Game</h1>
      <button id="startButton">Start Game</button>
      <div id="gameArea">
        <div id="character"></div>
      </div>
      <div id="score">Score: 0</div>
      <div id="instructions">
        Use arrow keys to move and avoid the red objects!
      </div>
    </div>

    <div id="modal">
      <div class="modal-content">
        <span id="closeModal">&times;</span>
        <h2>END GAME</h2>
        <p id="finalScore"></p>
        <img
          id="gameOverGif"
          src="assets/gameover.gif"
          alt="Game Over GIF"
          style="max-width: 100%; height: auto"
        />
      </div>
    </div>

    <script>
      const gameArea = document.getElementById("gameArea");
      const character = document.getElementById("character");
      const scoreDisplay = document.getElementById("score");
      const startButton = document.getElementById("startButton");
      const modal = document.getElementById("modal");
      const closeModal = document.getElementById("closeModal");
      const finalScore = document.getElementById("finalScore");
      let score = 0;
      let gameLoop;
      let objectInterval = 1000; // Start with 1 second interval
      let gameActive = false;
      let characterX = 190;
      let characterY = 190;
      const speed = 8; // Increased speed from 5 to 8

      startButton.addEventListener("click", startGame);
      closeModal.addEventListener("click", () => {
        modal.style.display = "none";
      });

      function updateCharacterPosition() {
        character.style.left = `${characterX}px`;
        character.style.top = `${characterY}px`;
      }

      document.addEventListener("keydown", moveCharacter);

      function moveCharacter(e) {
        if (!gameActive) return;

        switch (e.key) {
          case "ArrowLeft":
            characterX = Math.max(0, characterX - speed);
            break;
          case "ArrowRight":
            characterX = Math.min(380, characterX + speed);
            break;
          case "ArrowUp":
            characterY = Math.max(0, characterY - speed);
            break;
          case "ArrowDown":
            characterY = Math.min(380, characterY + speed);
            break;
        }
        updateCharacterPosition();
      }

      function createObject() {
        if (!gameActive) return;

        const object = document.createElement("div");
        object.classList.add("object");
        object.style.left = `${Math.random() * 390}px`;
        object.style.top = `${Math.random() * 390}px`;
        gameArea.appendChild(object);

        function moveTowardsCharacter() {
          if (!gameActive) {
            object.remove();
            return;
          }

          const objLeft = parseFloat(object.style.left);
          const objTop = parseFloat(object.style.top);

          const angle = Math.atan2(characterY - objTop, characterX - objLeft);
          const newLeft = objLeft + Math.cos(angle) * 1;
          const newTop = objTop + Math.sin(angle) * 1;

          object.style.left = `${newLeft}px`;
          object.style.top = `${newTop}px`;

          if (checkCollision(object, character)) {
            gameOver();
          } else {
            requestAnimationFrame(moveTowardsCharacter);
          }
        }

        moveTowardsCharacter();
      }

      function checkCollision(obj1, obj2) {
        const rect1 = obj1.getBoundingClientRect();
        const rect2 = obj2.getBoundingClientRect();
        return !(
          rect1.right < rect2.left ||
          rect1.left > rect2.right ||
          rect1.bottom < rect2.top ||
          rect1.top > rect2.bottom
        );
      }

      function updateScore() {
        if (!gameActive) return;
        score++;
        scoreDisplay.textContent = `Score: ${score}`;
      }

      function gameOver() {
        gameActive = false;
        clearInterval(gameLoop);

        // Remove all objects from the game area
        const objects = document.querySelectorAll(".object");
        objects.forEach((object) => object.remove());

        finalScore.textContent = `You made ${score} points`;

        // Set a specific GIF for the end game modal
        document.getElementById("gameOverGif").src = "assets/gameover.gif"; // Update the GIF URL if needed

        modal.style.display = "block";
        startButton.disabled = false;
      }

      function startGame() {
        gameActive = true;
        score = 0;
        objectInterval = 1000;
        scoreDisplay.textContent = "Score: 0";
        // Reset character position without removing it from the DOM
        characterX = 190;
        characterY = 190;
        updateCharacterPosition();
        startButton.disabled = true;

        gameLoop = setInterval(() => {
          createObject();
          updateScore();
        }, objectInterval);

        // Increase difficulty every minute
        setInterval(() => {
          if (gameActive && objectInterval > 100) {
            objectInterval -= 100;
            clearInterval(gameLoop);
            gameLoop = setInterval(() => {
              createObject();
              updateScore();
            }, objectInterval);
          }
        }, 60000);
      }
    </script>
  </body>
</html>
